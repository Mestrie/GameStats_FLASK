{% extends "base.html" %}

{% block title %}Cat√°logo de Jogos (P√°gina {{ pagina_atual }}){% endblock %}

{% block content %}
<!-- ========================= -->
<!-- üïπÔ∏è T√çTULO DA P√ÅGINA -->
<!-- ========================= -->
<h1 class="mb-3">Cat√°logo de Jogos (IGDB)</h1>
<p class="mb-4">Exibindo jogos da p√°gina <strong>{{ pagina_atual }}</strong>. Clique em um jogo para ver sua an√°lise.</p>

<!-- ========================= -->
<!-- üîé FORMUL√ÅRIO DE PESQUISA -->
<!-- ========================= -->
<div class="mb-4 p-4 bg-light rounded-4 shadow-sm">
    <form action="{{ url_for('listagem') }}" method="GET" id="search-form" class="row g-2 align-items-center">
        <div class="col-sm-auto">
            <label for="pesquisa" class="form-label fw-semibold">Pesquisar Jogo:</label>
        </div>
        <div class="col-sm">
            <input 
                type="text" 
                id="pesquisa" 
                name="pesquisa" 
                placeholder="Digite o nome do jogo..." 
                value="{{ termo_pesquisa or '' }}" 
                class="form-control"
            >
        </div>
        <input type="hidden" name="pagina" value="1">
        <div class="col-sm-auto">
            <button type="submit" class="btn btn-primary">Buscar</button>
            {% if termo_pesquisa %}
                <a href="{{ url_for('listagem') }}" class="btn btn-outline-danger">Limpar Pesquisa</a>
            {% endif %}
        </div>
    </form>
</div>
<script src="{{ url_for('static', filename='autocomplete.js') }}"></script>

<!-- ========================= -->
<!-- ‚öôÔ∏è FILTROS AVAN√áADOS -->
<!-- ========================= -->
<div class="mb-4 d-flex flex-wrap gap-2 align-items-center">

    <!-- Plataforma -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Plataforma
        </button>
        <ul class="dropdown-menu">
            {% for plataforma in filtros.platforms %}
                <li><a class="dropdown-item" href="{{ url_for('listagem', platform=plataforma) }}">{{ plataforma }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <!-- G√™nero -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            G√™nero
        </button>
        <ul class="dropdown-menu">
            {% for genero in filtros.genres %}
                <li><a class="dropdown-item" href="{{ url_for('listagem', genre=genero) }}">{{ genero }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <!-- Modo -->
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Modo
        </button>
        <ul class="dropdown-menu">
            {% for modo in filtros.modes %}
                <li><a class="dropdown-item" href="{{ url_for('listagem', mode=modo) }}">{{ modo }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <!-- Limpar Filtros -->
    {% if platform_filter or genre_filter or mode_filter %}
        <a href="{{ url_for('listagem') }}" class="btn btn-outline-danger ms-2">
            Limpar filtros ‚úï
        </a>
    {% endif %}
</div>
<script src="{{ url_for('static', filename='filtros.js') }}"></script>

<!-- ========================= -->
<!-- üé¥ GRID DE JOGOS -->
<!-- ========================= -->
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    {% for jogo in jogos %}
    <div class="col">
        <div class="card card-jogo h-100 shadow-sm">
            <a href="{{ url_for('dashboards_detalhes', game_id=jogo.id) }}">
                <img src="{{ jogo.imagem_url }}" class="card-img-top" alt="Capa do Jogo {{ jogo.titulo }}">
                <div class="card-body text-center">
                    <h5 class="card-title text-primary">{{ jogo.titulo }}</h5>
                </div>
            </a>
        </div>
    </div>
    {% endfor %}
</div>

<!-- ========================= -->
<!-- ‚¨ÖÔ∏è‚û°Ô∏è PAGINA√á√ÉO -->
<!-- ========================= -->
<nav aria-label="Navega√ß√£o de p√°gina" class="mt-5">
    <ul class="pagination justify-content-center custom-pagination">
        
        {% if pagina_atual > 1 %}
            <li class="page-item">
                <a class="page-link shadow-sm" href="{{ url_for('listagem', pagina=pagina_atual - 1, pesquisa=termo_pesquisa) }}">
                    <i class="bi bi-chevron-left"></i> Anterior
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link shadow-none">&laquo; Anterior</span>
            </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link px-4 shadow">
                {{ pagina_atual }}
            </span>
        </li>

        {% if proxima_pagina_existe %}
            <li class="page-item">
                <a class="page-link shadow-sm" href="{{ url_for('listagem', pagina=pagina_atual + 1, pesquisa=termo_pesquisa) }}">
                    Pr√≥xima <i class="bi bi-chevron-right"></i>
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link shadow-none">Pr√≥xima &raquo;</span>
            </li>
        {% endif %}
        
    </ul>
</nav>
{% endblock %}
