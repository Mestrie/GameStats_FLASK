{% extends "base.html" %}

{% block title %}
Detalhes - {{ detalhes.name or "Jogo Desconhecido" }}
{% endblock %}

{% block content %}

<h1>{{ detalhes.name }}</h1>

<hr>

<!-- ========================= -->
<!-- üìä NOTAS -->
<!-- ========================= -->

<h2>Notas</h2>

<p><strong>Nota IGDB:</strong>
{% if detalhes.rating %}
    {{ "%.1f"|format(detalhes.rating) }}/100
{% else %}
    N√£o dispon√≠vel
{% endif %}
</p>

<p><strong>M√©dia dos usu√°rios:</strong>
{% if media_usuarios %}
    {{ "%.1f"|format(media_usuarios) }}/100
    <span style="color: #666;">
        ({{ quantidade_usuarios }} usu√°rio{{ 's' if quantidade_usuarios != 1 }})
    </span>
{% else %}
    Ainda n√£o avaliado
{% endif %}
</p>

<hr>


<!-- ========================= -->
<!-- üñºÔ∏è IMAGEM -->
<!-- ========================= -->

<img src="{{ detalhes.image_url }}" alt="Capa do jogo" width="300">

<hr>

<!-- ========================= -->
<!-- üìñ RESUMO -->
<!-- ========================= -->

<h2>Resumo</h2>
<p>{{ detalhes.summary or "Sem descri√ß√£o dispon√≠vel." }}</p>

<hr>

<!-- ========================= -->
<!-- ‚úçÔ∏è FORMUL√ÅRIO DE REVIEW -->
<!-- ========================= -->

<h2>Sua avalia√ß√£o</h2>

<form action="{{ url_for('salvar_review', game_id=game_id) }}" method="POST">

    <label>Nota (0 a 100)</label><br>
    <input
        type="number"
        name="rating"
        min="0"
        max="100"
        required
        value="{{ review_usuario.rating if review_usuario else '' }}"
    ><br><br>

    <label>Review</label><br>
    <textarea
        name="comment"
        rows="4"
        cols="50"
        required
    >{{ review_usuario.comment if review_usuario else '' }}</textarea><br><br>

    <button type="submit">
        {{ "Atualizar Review" if review_usuario else "Enviar Review" }}
    </button>
</form>


<hr>

<!-- ========================= -->
<!-- üßæ REVIEWS DOS USU√ÅRIOS -->
<!-- ========================= -->

<h2>Reviews dos usu√°rios</h2>

{% if reviews %}
    {% for review in reviews %}
        <div>
            <p><strong>{{ review.user.username }}</strong></p>
            <p>Nota: {{ review.rating }}/100</p>
            <p>{{ review.comment }}</p>
            <small>{{ review.created_at.strftime("%d/%m/%Y") }}</small>
        </div>
        <hr>
    {% endfor %}
{% else %}
    <p>Nenhuma review ainda.</p>
{% endif %}

<hr>

<!-- ========================= -->
<!-- üì∫ DASHBOARD TWITCH -->
<!-- ========================= -->

<h2>Streams ativas na Twitch</h2>

<div>
    <canvas id="visualizadorChart"></canvas>
</div>

<div>
    <canvas id="avaliacaoChart"></canvas>
</div>

<!-- ========================= -->
<!-- üîß VARI√ÅVEIS PARA JS -->
<!-- ========================= -->

<script>
    window.gameId = "{{ game_id }}";
    window.gameName = "{{ detalhes.name }}";
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>

{% endblock %}
